{"ast":null,"code":"import { of } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let AnimeService = /*#__PURE__*/(() => {\n  class AnimeService {\n    http;\n    JIKAN_API_URL = 'https://api.jikan.moe/v4';\n    cache = new Map();\n    cacheTimeout = 5 * 60 * 1000;\n    constructor(http) {\n      this.http = http;\n    }\n    getTopAnimes(limit = 10) {\n      const cacheKey = `top_animes_${limit}`;\n      if (this.cache.has(cacheKey)) {\n        const cached = this.cache.get(cacheKey);\n        if (Date.now() - cached.timestamp < this.cacheTimeout) {\n          return of(cached.data);\n        }\n      }\n      return this.http.get(`${this.JIKAN_API_URL}/top/anime?limit=${limit}`).pipe(map(response => {\n        if (response && response.data) {\n          this.cache.set(cacheKey, {\n            data: response.data,\n            timestamp: Date.now()\n          });\n          return response.data;\n        }\n        return [];\n      }), catchError(error => {\n        console.error('Error fetching top animes:', error);\n        return of([]);\n      }));\n    }\n    getAnimeById(id) {\n      const cacheKey = `anime_${id}`;\n      if (this.cache.has(cacheKey)) {\n        const cached = this.cache.get(cacheKey);\n        if (Date.now() - cached.timestamp < this.cacheTimeout) {\n          return of(cached.data);\n        }\n      }\n      return this.http.get(`${this.JIKAN_API_URL}/anime/${id}/full`).pipe(map(response => {\n        if (response && response.data) {\n          this.cache.set(cacheKey, {\n            data: response.data,\n            timestamp: Date.now()\n          });\n          return response.data;\n        }\n        return null;\n      }), catchError(error => {\n        console.error('Error fetching anime by id:', error);\n        return of(null);\n      }));\n    }\n    searchAnimes(query, limit = 20) {\n      if (!query || query.trim().length < 3) {\n        return of([]);\n      }\n      return this.http.get(`${this.JIKAN_API_URL}/anime?q=${encodeURIComponent(query)}&limit=${limit}`).pipe(map(response => {\n        if (response && response.data) {\n          return response.data;\n        }\n        return [];\n      }), catchError(error => {\n        console.error('Error searching animes:', error);\n        return of([]);\n      }));\n    }\n    calculateAverageRating(reviews) {\n      if (!reviews || reviews.length === 0) {\n        return 0;\n      }\n      const sum = reviews.reduce((acc, review) => acc + review.rating, 0);\n      return Math.round(sum / reviews.length * 10) / 10;\n    }\n    clearCache() {\n      this.cache.clear();\n    }\n    static ɵfac = function AnimeService_Factory(t) {\n      return new (t || AnimeService)(i0.ɵɵinject(i1.HttpClient));\n    };\n    static ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AnimeService,\n      factory: AnimeService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n  return AnimeService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}