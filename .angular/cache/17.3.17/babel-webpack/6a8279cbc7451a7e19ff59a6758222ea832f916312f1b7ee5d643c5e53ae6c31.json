{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/Equipo/Downloads/AppAnime/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ionic/storage-angular\";\nexport let StorageService = /*#__PURE__*/(() => {\n  class StorageService {\n    storage;\n    _storage = null;\n    STORAGE_PREFIX = 'animereview_';\n    constructor(storage) {\n      this.storage = storage;\n      this.init();\n    }\n    init() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        const storage = yield _this.storage.create();\n        _this._storage = storage;\n        yield _this.initializeDefaultData();\n      })();\n    }\n    initializeDefaultData() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        const initialized = yield _this2._storage?.get(_this2.getKey('initialized'));\n        if (!initialized) {\n          const defaultData = {\n            users: [],\n            reviews: [],\n            favorites: [],\n            preferences: {\n              notifications: true,\n              darkMode: false,\n              language: 'es'\n            }\n          };\n          yield _this2._storage?.set(_this2.getKey('users'), defaultData.users);\n          yield _this2._storage?.set(_this2.getKey('reviews'), defaultData.reviews);\n          yield _this2._storage?.set(_this2.getKey('favorites'), defaultData.favorites);\n          yield _this2._storage?.set(_this2.getKey('preferences'), defaultData.preferences);\n          yield _this2._storage?.set(_this2.getKey('initialized'), true);\n        }\n      })();\n    }\n    getKey(key) {\n      return `${this.STORAGE_PREFIX}${key}`;\n    }\n    set(key, value) {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        if (!_this3._storage) {\n          yield _this3.init();\n        }\n        yield _this3._storage?.set(_this3.getKey(key), value);\n      })();\n    }\n    get(key) {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        if (!_this4._storage) {\n          yield _this4.init();\n        }\n        return (yield _this4._storage?.get(_this4.getKey(key))) || null;\n      })();\n    }\n    remove(key) {\n      var _this5 = this;\n      return _asyncToGenerator(function* () {\n        if (!_this5._storage) {\n          yield _this5.init();\n        }\n        yield _this5._storage?.remove(_this5.getKey(key));\n      })();\n    }\n    clear() {\n      var _this6 = this;\n      return _asyncToGenerator(function* () {\n        if (!_this6._storage) {\n          yield _this6.init();\n        }\n        const keys = yield _this6.keys();\n        for (const key of keys) {\n          yield _this6._storage?.remove(_this6.getKey(key));\n        }\n        yield _this6.initializeDefaultData();\n      })();\n    }\n    keys() {\n      var _this7 = this;\n      return _asyncToGenerator(function* () {\n        if (!_this7._storage) {\n          yield _this7.init();\n        }\n        const allKeys = (yield _this7._storage?.keys()) || [];\n        return allKeys.filter(key => key.startsWith(_this7.STORAGE_PREFIX)).map(key => key.replace(_this7.STORAGE_PREFIX, ''));\n      })();\n    }\n    // Métodos específicos para Reviews\n    saveReview(review) {\n      var _this8 = this;\n      return _asyncToGenerator(function* () {\n        const reviews = yield _this8.getAllReviews();\n        if (review.id) {\n          // Actualizar review existente\n          const index = reviews.findIndex(r => r.id === review.id);\n          if (index !== -1) {\n            reviews[index] = {\n              ...review,\n              updatedAt: new Date().toISOString()\n            };\n          } else {\n            reviews.push({\n              ...review,\n              id: `review_${Date.now()}`,\n              createdAt: new Date().toISOString()\n            });\n          }\n        } else {\n          // Crear nueva review\n          reviews.push({\n            ...review,\n            id: `review_${Date.now()}`,\n            createdAt: new Date().toISOString()\n          });\n        }\n        yield _this8.set('reviews', reviews);\n      })();\n    }\n    getAllReviews() {\n      var _this9 = this;\n      return _asyncToGenerator(function* () {\n        const reviews = yield _this9.get('reviews');\n        return reviews || [];\n      })();\n    }\n    getReviewsByAnime(animeId) {\n      var _this0 = this;\n      return _asyncToGenerator(function* () {\n        const reviews = yield _this0.getAllReviews();\n        return reviews.filter(r => r.animeId === animeId);\n      })();\n    }\n    getReviewsByUser(userId) {\n      var _this1 = this;\n      return _asyncToGenerator(function* () {\n        const reviews = yield _this1.getAllReviews();\n        return reviews.filter(r => r.userId === userId);\n      })();\n    }\n    deleteReview(reviewId) {\n      var _this10 = this;\n      return _asyncToGenerator(function* () {\n        const reviews = yield _this10.getAllReviews();\n        const filteredReviews = reviews.filter(r => r.id !== reviewId);\n        yield _this10.set('reviews', filteredReviews);\n      })();\n    }\n    static ɵfac = function StorageService_Factory(t) {\n      return new (t || StorageService)(i0.ɵɵinject(i1.Storage));\n    };\n    static ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: StorageService,\n      factory: StorageService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n  return StorageService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}