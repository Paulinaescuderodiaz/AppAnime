{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/Equipo/Downloads/AppAnime/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { BehaviorSubject } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./storage.service\";\nexport let AuthService = /*#__PURE__*/(() => {\n  class AuthService {\n    storageService;\n    currentUserSubject = new BehaviorSubject(null);\n    currentUser$ = this.currentUserSubject.asObservable();\n    isAuthenticated$;\n    constructor(storageService) {\n      this.storageService = storageService;\n      this.isAuthenticated$ = this.currentUser$.pipe(map(user => user !== null));\n      this.loadCurrentUser();\n    }\n    loadCurrentUser() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        const user = yield _this.storageService.get('currentUser');\n        _this.currentUserSubject.next(user);\n      })();\n    }\n    getCurrentUser() {\n      return this.currentUser$;\n    }\n    getCurrentUserValue() {\n      return this.currentUserSubject.value;\n    }\n    // Login con Email y Contraseña (SQLite)\n    loginWithEmail(email, password) {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          // Obtener usuarios registrados\n          const users = (yield _this2.storageService.get('users')) || [];\n          // Buscar usuario\n          const user = users.find(u => u.email === email && u.password === password);\n          if (user) {\n            // Guardar sesión\n            const sessionUser = {\n              uid: user.uid,\n              id: user.uid,\n              email: user.email,\n              displayName: user.fullName,\n              fullName: user.fullName,\n              photoURL: null,\n              authProvider: 'Email',\n              createdAt: user.createdAt\n            };\n            yield _this2.storageService.set('currentUser', sessionUser);\n            _this2.currentUserSubject.next(sessionUser);\n            return {\n              success: true,\n              user: sessionUser\n            };\n          } else {\n            return {\n              success: false,\n              message: 'Credenciales incorrectas'\n            };\n          }\n        } catch (error) {\n          console.error('Login error:', error);\n          return {\n            success: false,\n            message: 'Error al iniciar sesión'\n          };\n        }\n      })();\n    }\n    // Registro con Email y Contraseña (SQLite)\n    registerWithEmail(email, password, fullName) {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          // Obtener usuarios existentes\n          const users = (yield _this3.storageService.get('users')) || [];\n          // Verificar si el email ya existe\n          const existingUser = users.find(u => u.email === email);\n          if (existingUser) {\n            return {\n              success: false,\n              message: 'Este email ya está registrado'\n            };\n          }\n          // Crear nuevo usuario\n          const newUser = {\n            uid: `user_${Date.now()}`,\n            email,\n            password,\n            fullName,\n            createdAt: new Date().toISOString(),\n            authProvider: 'Email'\n          };\n          // Guardar usuario\n          users.push(newUser);\n          yield _this3.storageService.set('users', users);\n          // Crear sesión\n          const sessionUser = {\n            uid: newUser.uid,\n            id: newUser.uid,\n            email: newUser.email,\n            displayName: newUser.fullName,\n            fullName: newUser.fullName,\n            photoURL: null,\n            authProvider: 'Email',\n            createdAt: newUser.createdAt\n          };\n          yield _this3.storageService.set('currentUser', sessionUser);\n          _this3.currentUserSubject.next(sessionUser);\n          return {\n            success: true,\n            user: sessionUser\n          };\n        } catch (error) {\n          console.error('Register error:', error);\n          return {\n            success: false,\n            message: 'Error al registrar usuario'\n          };\n        }\n      })();\n    }\n    // Login con Google (Simulado para desarrollo)\n    loginWithGoogle() {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          // Simulación de login con Google\n          // En producción, usar Firebase Authentication\n          const googleUser = {\n            uid: `google_${Date.now()}`,\n            id: `google_${Date.now()}`,\n            email: 'usuario@gmail.com',\n            displayName: 'Usuario Google',\n            fullName: 'Usuario Google',\n            photoURL: 'https://ui-avatars.com/api/?name=Usuario+Google&background=667eea&color=fff',\n            authProvider: 'Google',\n            createdAt: new Date().toISOString()\n          };\n          yield _this4.storageService.set('currentUser', googleUser);\n          _this4.currentUserSubject.next(googleUser);\n          return {\n            success: true,\n            user: googleUser\n          };\n        } catch (error) {\n          console.error('Google login error:', error);\n          return {\n            success: false,\n            message: 'Error al iniciar sesión con Google'\n          };\n        }\n      })();\n    }\n    // Actualizar contraseña\n    updatePassword(currentPassword, newPassword) {\n      var _this5 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const currentUser = _this5.currentUserSubject.value;\n          if (!currentUser || currentUser.authProvider === 'Google') {\n            return {\n              success: false,\n              message: 'No se puede cambiar la contraseña de una cuenta de Google'\n            };\n          }\n          const users = (yield _this5.storageService.get('users')) || [];\n          const userIndex = users.findIndex(u => u.email === currentUser.email);\n          if (userIndex === -1) {\n            return {\n              success: false,\n              message: 'Usuario no encontrado'\n            };\n          }\n          // Verificar contraseña actual\n          if (users[userIndex].password !== currentPassword) {\n            return {\n              success: false,\n              message: 'Contraseña actual incorrecta'\n            };\n          }\n          // Actualizar contraseña\n          users[userIndex].password = newPassword;\n          yield _this5.storageService.set('users', users);\n          return {\n            success: true,\n            message: 'Contraseña actualizada correctamente'\n          };\n        } catch (error) {\n          console.error('Update password error:', error);\n          return {\n            success: false,\n            message: 'Error al actualizar contraseña'\n          };\n        }\n      })();\n    }\n    // Actualizar perfil\n    updateProfile(updates) {\n      var _this6 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const currentUser = _this6.currentUserSubject.value;\n          if (!currentUser) {\n            return {\n              success: false,\n              message: 'No hay usuario autenticado'\n            };\n          }\n          // Actualizar en la lista de usuarios\n          const users = (yield _this6.storageService.get('users')) || [];\n          const userIndex = users.findIndex(u => u.uid === currentUser.uid);\n          if (userIndex !== -1) {\n            if (updates.fullName) {\n              users[userIndex].fullName = updates.fullName;\n              yield _this6.storageService.set('users', users);\n            }\n          }\n          // Actualizar usuario actual\n          const updatedUser = {\n            ...currentUser,\n            fullName: updates.fullName || currentUser.fullName,\n            displayName: updates.fullName || currentUser.displayName\n          };\n          yield _this6.storageService.set('currentUser', updatedUser);\n          _this6.currentUserSubject.next(updatedUser);\n          return {\n            success: true,\n            user: updatedUser\n          };\n        } catch (error) {\n          console.error('Update profile error:', error);\n          return {\n            success: false,\n            message: 'Error al actualizar el perfil'\n          };\n        }\n      })();\n    }\n    // Cambiar contraseña (alias para updatePassword)\n    changePassword(currentPassword, newPassword) {\n      var _this7 = this;\n      return _asyncToGenerator(function* () {\n        return _this7.updatePassword(currentPassword, newPassword);\n      })();\n    }\n    // Cerrar sesión\n    logout() {\n      var _this8 = this;\n      return _asyncToGenerator(function* () {\n        yield _this8.storageService.remove('currentUser');\n        _this8.currentUserSubject.next(null);\n      })();\n    }\n    // Eliminar cuenta\n    deleteAccount() {\n      var _this9 = this;\n      return _asyncToGenerator(function* () {\n        const currentUser = _this9.currentUserSubject.value;\n        if (currentUser) {\n          // Eliminar usuario de la lista\n          const users = (yield _this9.storageService.get('users')) || [];\n          const filteredUsers = users.filter(u => u.uid !== currentUser.uid);\n          yield _this9.storageService.set('users', filteredUsers);\n          // Eliminar reseñas del usuario\n          const reviews = yield _this9.storageService.getAllReviews();\n          const filteredReviews = reviews.filter(r => r.userId !== currentUser.uid);\n          yield _this9.storageService.set('reviews', filteredReviews);\n          // Cerrar sesión\n          yield _this9.logout();\n        }\n      })();\n    }\n    // Verificar si hay sesión activa (método legacy para compatibilidad)\n    isAuthenticated() {\n      var _this0 = this;\n      return _asyncToGenerator(function* () {\n        const user = yield _this0.storageService.get('currentUser');\n        return user !== null;\n      })();\n    }\n    static ɵfac = function AuthService_Factory(t) {\n      return new (t || AuthService)(i0.ɵɵinject(i1.StorageService));\n    };\n    static ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n  return AuthService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}