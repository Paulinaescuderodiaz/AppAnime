{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/Equipo/Downloads/AppAnime/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nlet HomePage = class HomePage {\n  animeService;\n  reviewService;\n  authService;\n  router;\n  loadingController;\n  alertController;\n  topAnimes = [];\n  reviews = {};\n  currentUser = null;\n  isLoading = true;\n  constructor(animeService, reviewService, authService, router, loadingController, alertController) {\n    this.animeService = animeService;\n    this.reviewService = reviewService;\n    this.authService = authService;\n    this.router = router;\n    this.loadingController = loadingController;\n    this.alertController = alertController;\n  }\n  ngOnInit() {\n    this.loadData();\n  }\n  ionViewWillEnter() {\n    this.loadData();\n  }\n  loadData() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      _this.isLoading = true;\n      _this.authService.getCurrentUser().subscribe(user => {\n        _this.currentUser = user;\n      });\n      _this.animeService.getTopAnimes(10).subscribe({\n        next: animes => {\n          _this.topAnimes = animes;\n          _this.loadReviews();\n        },\n        error: error => {\n          console.error('Error cargando animes:', error);\n          _this.isLoading = false;\n          _this.showAlert('Error', 'No se pudieron cargar los animes');\n        }\n      });\n    })();\n  }\n  loadReviews() {\n    this.topAnimes.forEach(anime => {\n      this.reviewService.getReviewsByAnime(anime.mal_id).subscribe({\n        next: reviews => {\n          this.reviews[anime.mal_id] = reviews;\n        }\n      });\n    });\n    this.isLoading = false;\n  }\n  refreshData(event) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      yield _this2.loadData();\n      event.target.complete();\n    })();\n  }\n  viewAnimeDetail(anime) {\n    this.router.navigate(['/anime-detail', anime.mal_id]);\n  }\n  addReview(anime) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      if (!_this3.currentUser) {\n        _this3.showAlert('Error', 'Debes iniciar sesión para dejar una reseña');\n        return;\n      }\n      const hasReviewed = yield _this3.reviewService.hasUserReviewed(_this3.currentUser.id, anime.mal_id);\n      if (hasReviewed) {\n        _this3.showAlert('Info', 'Ya has dejado una reseña para este anime');\n        return;\n      }\n      const alert = yield _this3.alertController.create({\n        header: `Reseña de ${anime.title}`,\n        inputs: [{\n          name: 'rating',\n          type: 'number',\n          placeholder: 'Calificación (1-10)',\n          min: 1,\n          max: 10\n        }, {\n          name: 'comment',\n          type: 'textarea',\n          placeholder: 'Escribe tu comentario...'\n        }],\n        buttons: [{\n          text: 'Cancelar',\n          role: 'cancel'\n        }, {\n          text: 'Publicar',\n          handler: data => {\n            _this3.submitReview(anime, data.rating, data.comment);\n          }\n        }]\n      });\n      yield alert.present();\n    })();\n  }\n  submitReview(anime, rating, comment) {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      if (!rating || !comment) {\n        _this4.showAlert('Error', 'Por favor completa todos los campos');\n        return;\n      }\n      const ratingNum = parseInt(rating);\n      if (ratingNum < 1 || ratingNum > 10) {\n        _this4.showAlert('Error', 'La calificación debe estar entre 1 y 10');\n        return;\n      }\n      const review = {\n        animeId: anime.mal_id,\n        animeName: anime.title,\n        userId: _this4.currentUser.id,\n        userEmail: _this4.currentUser.email,\n        userName: _this4.currentUser.fullName,\n        rating: ratingNum,\n        comment: comment.trim(),\n        createdAt: new Date()\n      };\n      const loading = yield _this4.loadingController.create({\n        message: 'Publicando reseña...'\n      });\n      yield loading.present();\n      _this4.reviewService.saveReview(review).subscribe({\n        next: () => {\n          loading.dismiss();\n          _this4.showAlert('¡Listo!', 'Tu reseña ha sido publicada');\n          _this4.loadReviews();\n        },\n        error: () => {\n          loading.dismiss();\n          _this4.showAlert('Error', 'No se pudo publicar la reseña');\n        }\n      });\n    })();\n  }\n  getAnimeReviews(animeId) {\n    return this.reviews[animeId] || [];\n  }\n  getAverageRating(animeId) {\n    const animeReviews = this.getAnimeReviews(animeId);\n    return this.animeService.calculateAverageRating(animeReviews);\n  }\n  goToProfile() {\n    this.router.navigate(['/profile']);\n  }\n  showAlert(header, message) {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      const alert = yield _this5.alertController.create({\n        header,\n        message,\n        buttons: ['OK']\n      });\n      yield alert.present();\n    })();\n  }\n  formatDate(date) {\n    return new Date(date).toLocaleDateString('es-ES', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric'\n    });\n  }\n};\nHomePage = __decorate([Component({\n  selector: 'app-home',\n  templateUrl: './home.page.html',\n  styleUrls: ['./home.page.scss']\n})], HomePage);\nexport { HomePage };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}