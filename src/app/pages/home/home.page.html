<ion-header [translucent]="true">
  <ion-toolbar color="dark">
    <ion-title>
      <ion-icon name="film-outline"></ion-icon>
      Top 10 Animes
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="goToProfile()" class="profile-button">
        <ion-icon name="person-circle-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="home-content">
  <!-- Refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="refreshData($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Cargando animes...</p>
  </div>

  <!-- Lista de Top Animes -->
  <div *ngIf="!isLoading" class="animes-container">
    <div class="header-section">
      <h2>üèÜ Top 10 Mejores Animes</h2>
      <p>Los animes mejor rankeados seg√∫n MyAnimeList</p>
    </div>

    <ion-card *ngFor="let anime of topAnimes; let i = index" class="anime-card">
      <div class="rank-badge">#{{ i + 1 }}</div>
      
      <div class="anime-header" (click)="viewAnimeDetail(anime)">
        <img [src]="anime.images?.webp?.large_image_url || anime.images?.jpg?.large_image_url || 'https://via.placeholder.com/300x400'" [alt]="anime.title" class="anime-image"/>
        <div class="anime-info">
          <h3>{{ anime.title }}</h3>
          <p class="anime-japanese">{{ anime.title_japanese || anime.title_english }}</p>
          
          <div class="ratings">
            <div class="mal-rating">
              <ion-icon name="star"></ion-icon>
              <span>{{ anime.score || 'N/A' }}</span>
            </div>
            <div class="local-rating" *ngIf="getAverageRating(anime.mal_id) > 0">
              <ion-icon name="heart"></ion-icon>
              <span>{{ getAverageRating(anime.mal_id) }} (Local)</span>
            </div>
          </div>

          <ion-badge color="primary" *ngIf="anime.episodes">
            {{ anime.episodes }} episodios
          </ion-badge>
          <ion-badge color="secondary" *ngIf="anime.status">
            {{ anime.status }}
          </ion-badge>
        </div>
      </div>

      <ion-card-content>
        <p class="synopsis">{{ getSynopsisPreview(anime.synopsis) }}</p>

        <!-- Rese√±as -->
        <div class="reviews-section">
          <div class="reviews-header">
            <h4>
              <ion-icon name="chatbubbles-outline"></ion-icon>
              Rese√±as ({{ getAnimeReviews(anime.mal_id).length }})
            </h4>
            <ion-button size="small" fill="outline" (click)="addReview(anime)">
              <ion-icon name="add-circle-outline" slot="start"></ion-icon>
              Agregar
            </ion-button>
          </div>

          <div class="reviews-list" *ngIf="getAnimeReviews(anime.mal_id).length > 0">
            <div class="review-item" *ngFor="let review of getAnimeReviews(anime.mal_id).slice(0, 3)">
              <div class="review-header">
                <div class="user-info">
                  <ion-icon name="person-circle-outline"></ion-icon>
                  <strong>{{ review.userName }}</strong>
                </div>
                <div class="review-rating">
                  <ion-icon name="star" color="warning"></ion-icon>
                  <span>{{ review.rating }}/10</span>
                </div>
              </div>
              <p class="review-comment">{{ review.comment }}</p>
              <span class="review-date">{{ formatDate(review.createdAt) }}</span>
            </div>
          </div>

          <div class="no-reviews" *ngIf="getAnimeReviews(anime.mal_id).length === 0">
            <ion-icon name="chatbubble-ellipses-outline"></ion-icon>
            <p>S√© el primero en dejar una rese√±a</p>
          </div>
        </div>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
