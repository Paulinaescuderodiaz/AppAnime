<ion-header [translucent]="true">
  <ion-toolbar color="dark">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home" text=""></ion-back-button>
    </ion-buttons>
    <ion-title>Perfil</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="logout()" color="danger">
        <ion-icon name="log-out-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="profile-content">
  <div class="profile-container" *ngIf="currentUser">
    
    <!-- Header con avatar -->
    <div class="profile-header">
      <div class="avatar-circle">
        <ion-icon name="person"></ion-icon>
      </div>
      <h2>{{ currentUser.fullName }}</h2>
      <p>{{ currentUser.email }}</p>
      <ion-badge [color]="currentUser.provider === 'google' ? 'danger' : 'primary'">
        {{ currentUser.provider === 'google' ? 'Google' : 'Local' }}
      </ion-badge>
    </div>

    <!-- Información del perfil -->
    <ion-card class="profile-card">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="person-circle-outline"></ion-icon>
          Información Personal
        </ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <ion-item lines="none" class="profile-item">
          <ion-label position="stacked">Nombre Completo</ion-label>
          <ion-input
            [(ngModel)]="fullName"
            [readonly]="!isEditing"
            [class.editing]="isEditing"
          ></ion-input>
        </ion-item>

        <ion-item lines="none" class="profile-item">
          <ion-label position="stacked">Correo Electrónico</ion-label>
          <ion-input
            [(ngModel)]="email"
            readonly
            class="readonly-input"
          ></ion-input>
        </ion-item>

        <div class="button-group">
          <ion-button
            *ngIf="!isEditing"
            expand="block"
            (click)="toggleEdit()"
          >
            <ion-icon name="create-outline" slot="start"></ion-icon>
            Editar Perfil
          </ion-button>

          <div *ngIf="isEditing" class="edit-buttons">
            <ion-button
              expand="block"
              color="success"
              (click)="saveProfile()"
            >
              <ion-icon name="checkmark-outline" slot="start"></ion-icon>
              Guardar
            </ion-button>
            <ion-button
              expand="block"
              fill="outline"
              (click)="toggleEdit()"
            >
              <ion-icon name="close-outline" slot="start"></ion-icon>
              Cancelar
            </ion-button>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Seguridad -->
    <ion-card class="profile-card" *ngIf="currentUser.provider !== 'google'">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="lock-closed-outline"></ion-icon>
          Seguridad
        </ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <ion-button
          expand="block"
          fill="outline"
          (click)="changePassword()"
        >
          <ion-icon name="key-outline" slot="start"></ion-icon>
          Cambiar Contraseña
        </ion-button>
      </ion-card-content>
    </ion-card>

    <!-- Cerrar sesión -->
    <ion-card class="profile-card logout-card">
      <ion-card-content>
        <ion-button
          expand="block"
          color="danger"
          fill="outline"
          (click)="logout()"
        >
          <ion-icon name="log-out-outline" slot="start"></ion-icon>
          Cerrar Sesión
        </ion-button>
      </ion-card-content>
    </ion-card>

  </div>
</ion-content>
